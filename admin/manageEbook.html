<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Ebooks - Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/lucide.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();

            // Function to generate random data for an ebook
            function generateRandomEbook(id) {
                const titles = [
                    "The Forgotten Scroll", "Whispers of the Jungle", "Digital Dreams",
                    "Ancient Wisdom Revived", "Future of AI", "Culinary Adventures",
                    "Mysteries of the Deep", "Stars Beyond Reach", "Silent Echoes",
                    "Journey to the East", "Chronicles of Time", "The Last Frontier"
                ];
                const authors = [
                    "Ahmad Zaki", "Siti Nur", "Dr. Lim Wei", "Prof. Devi",
                    "Encik Rahman", "Puan Aminah", "Cikgu Tan", "Ustaz Khalid"
                ];
                const statuses = ["Pending", "Approved", "Rejected"];
                const currentYear = new Date().getFullYear();

                const randomTitle = titles[Math.floor(Math.random() * titles.length)];
                const randomAuthor = authors[Math.floor(Math.random() * authors.length)];
                const randomYear = Math.floor(Math.random() * (currentYear - 1900 + 1)) + 1900;
                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                const randomCoverWidth = Math.floor(Math.random() * (100 - 70 + 1)) + 70; // 70-100
                const randomCoverHeight = Math.floor(Math.random() * (130 - 100 + 1)) + 100; // 100-130
                const randomBgColor = Math.floor(Math.random()*16777215).toString(16);
                const randomTextColor = Math.floor(Math.random()*16777215).toString(16);
                const synopsis = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.";


                return {
                    id: id,
                    cover: `https://placehold.co/${randomCoverWidth}x${randomCoverHeight}/${randomBgColor}/${randomTextColor}?text=Book+${id}`,
                    title: randomTitle,
                    author: randomAuthor,
                    year: randomYear,
                    status: randomStatus,
                    synopsis: synopsis
                };
            }

            // Generate 10 random ebooks
            const ebooks = [];
            for (let i = 1; i <= 10; i++) {
                ebooks.push(generateRandomEbook(i));
            }

            // Custom Message Box (replaces alert())
            function showMessageBox(message, type) {
                const messageBox = document.createElement('div');
                messageBox.className = `message-box ${type}`;
                messageBox.innerHTML = `
                    <p>${message}</p>
                    <button class="message-box-close" onclick="this.parentNode.remove()">X</button>
                `;
                document.body.appendChild(messageBox);
                setTimeout(() => { messageBox.remove(); }, 3000);
            }

            // --- Original Modal Functionality Re-integrated ---
            let currentRow = null; // To keep track of the row being acted upon

            window.openSynopsisModal = function(btn) {
                currentRow = btn.closest('tr');
                const title = currentRow.querySelector('.book-title').textContent;
                const author = currentRow.querySelector('.book-author').textContent;
                // Find the book data based on the row's ID
                const bookId = parseInt(currentRow.id.replace('book-row-', ''));
                const bookData = ebooks.find(book => book.id === bookId);

                document.getElementById('synopsisModalTitle').textContent = `${title} by ${author}`;
                document.getElementById('synopsisText').textContent = bookData ? bookData.synopsis : 'Synopsis not available.';
                document.getElementById('synopsisModal').style.display = 'flex'; // Show modal

                // Reset rejection reason box state
                document.getElementById('rejectionReasonBox').style.display = 'none';
                document.getElementById('rejectionReason').value = '';
            };

            window.approveBookFromModal = function() {
                if (currentRow) {
                    const title = currentRow.querySelector('.book-title').textContent;
                    const statusCell = currentRow.querySelector('.status-cell');
                    const actionsCell = currentRow.querySelector('.actions-cell');

                    statusCell.innerHTML = '<span class="status-approved">Approved</span>';
                    actionsCell.innerHTML = '<span class="text-gray-500 text-sm">Actioned</span>';
                    showMessageBox(`✅ Approved: "${title}"`, 'success');
                }
                closeModal('synopsisModal');
            };

            window.toggleRejectionReason = function() {
                const rejectionReasonBox = document.getElementById('rejectionReasonBox');
                rejectionReasonBox.style.display = 'block'; // Always show when reject is clicked
            };

            window.submitRejection = function() {
                const reason = document.getElementById('rejectionReason').value.trim();
                if (reason === '') {
                    showMessageBox('Please enter a rejection reason.', 'error');
                    return;
                }

                if (currentRow) {
                    const title = currentRow.querySelector('.book-title').textContent;
                    const statusCell = currentRow.querySelector('.status-cell');
                    const actionsCell = currentRow.querySelector('.actions-cell');

                    statusCell.innerHTML = '<span class="status-rejected">Rejected</span>';
                    actionsCell.innerHTML = '<span class="text-gray-500 text-sm">Actioned</span>';
                    showMessageBox(`❌ Rejected: "${title}"\nReason: ${reason}`, 'error');
                }
                closeModal('synopsisModal');
            };

            window.closeModal = function(id) {
                document.getElementById(id).style.display = 'none';
                currentRow = null; // Clear currentRow when modal is closed
            };

            // Close modal when clicking outside
            window.onclick = function(event) {
                const synopsisModal = document.getElementById('synopsisModal');
                if (event.target === synopsisModal) {
                    closeModal('synopsisModal');
                }
            };

            // Search Functionality
            window.searchBooks = function() {
                const input = document.getElementById('searchInput').value.toLowerCase();
                const rows = document.querySelectorAll('#ebook-table tbody tr');

                rows.forEach(row => {
                    const title = row.querySelector('.book-title').textContent.toLowerCase();
                    const author = row.querySelector('.book-author').textContent.toLowerCase();
                    const year = row.querySelector('.book-year').textContent.toLowerCase();

                    if (title.includes(input) || author.includes(input) || year.includes(input)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            };

            // Render ebooks into the table
            const tbody = document.querySelector('.book-table tbody');
            ebooks.forEach(book => {
                const row = document.createElement('tr');
                row.id = `book-row-${book.id}`;
                let statusHtml = '';
                if (book.status === 'Pending') {
                    statusHtml = `<span class="status-pending">${book.status}</span>`;
                } else if (book.status === 'Approved') {
                    statusHtml = `<span class="status-approved">${book.status}</span>`;
                } else if (book.status === 'Rejected') {
                    statusHtml = `<span class="status-rejected">${book.status}</span>`;
                }

                let actionsHtml = '';
                if (book.status === 'Pending') {
                    actionsHtml = `
                        <button class="action-button view-synopsis-button" onclick="openSynopsisModal(this)">
                            <i class="lucide lucide-book"></i> View Synopsis
                        </button>
                    `;
                } else {
                    actionsHtml = `<span class="text-gray-500 text-sm">Actioned</span>`;
                }

                row.innerHTML = `
                    <td>
                        <img src="${book.cover}" alt="Book Cover" class="book-cover" onerror="this.onerror=null;this.src='https://placehold.co/80x120/cccccc/333333?text=No+Cover';">
                    </td>
                    <td><span class="book-title">${book.title}</span></td>
                    <td><span class="book-author">${book.author}</span></td>
                    <td><span class="book-year">${book.year}</span></td>
                    <td class="status-cell">${statusHtml}</td>
                    <td class="actions-cell">${actionsHtml}</td>
                `;
                tbody.appendChild(row);
            });
        });
    </script>
    <style>
        /* Root variables */
        :root {
            --primary: #1f2937;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --bg-light: #f7f9fc;
            --text-dark: #333;
            --gray: #6b7280;
        }

        /* General styling for the body */
        body {
            background: var(--bg-light);
            margin: 0;
            font-family: 'Poppins', sans-serif;
            color: var(--text-dark);
        }

        /* Main layout container for sidebar and content */
        .main-layout-container {
            display: flex;
            min-height: 100vh;
            background-color: var(--bg-light);
        }

        /* Sidebar styling */
        .sidebar {
            width: 256px;
            background-color: #1f2937;
            color: #ffffff;
            padding: 24px;
            border-top-right-radius: 12px;
            border-bottom-right-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            display: none;
            flex-shrink: 0;
        }

        @media (min-width: 768px) {
            .sidebar {
                display: block;
            }
        }

        .sidebar h2 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 24px;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar li {
            margin-bottom: 8px;
        }

        .sidebar a {
            display: flex;
            align-items: center;
            font-size: 1.125rem;
            padding: 8px 16px;
            border-radius: 8px;
            color: #ffffff;
            text-decoration: none;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        }

        .sidebar a:hover {
            background-color: #374151;
            color: #93c5fd;
        }

        .sidebar i {
            margin-right: 12px;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            padding: 30px;
        }

        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .page-header h1 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .page-header .date-info {
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* Search Bar */
        .search-bar {
            text-align: center;
            margin-bottom: 20px;
        }

        .search-bar input {
            padding: 10px;
            width: 500px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        /* Table Container */
        .table-container {
            max-width: 1100px;
            margin: auto;
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            overflow-x: auto;
        }

        .book-table {
            width: 100%;
            border-collapse: collapse;
            border-spacing: 0 15px;
            min-width: 600px;
        }

        .book-table th, .book-table td {
            padding: 1rem;
            text-align: center;
            border-bottom: 1px solid #e5e7eb;
        }

        .book-table th {
            background-color: var(--primary);
            color: #fff;
            padding: 12px;
            border-radius: 10px 10px 0 0;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.875rem;
        }

        .book-table tbody tr:hover {
            background-color: #f3f4f6;
        }

        .book-cover {
            width: 60px;
            height: 90px;
            object-fit: cover;
            border-radius: 6px;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .book-title {
            font-weight: 600;
            color: var(--text-dark);
        }

        .book-author, .book-year {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .actions-cell {
            white-space: nowrap;
        }

        .action-button {
            padding: 8px 14px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: 0.2s ease;
            margin-right: 0.5rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .action-button:hover {
            opacity: 0.85;
        }

        .view-synopsis-button {
            background-color: #3b82f6; /* A shade of blue for view */
            color: #ffffff;
        }
        .view-synopsis-button:hover {
            background-color: #2563eb;
        }

        .approve-button-modal { /* Renamed to avoid conflict with old handleAction */
            background-color: var(--success);
            color: #ffffff;
        }

        .approve-button-modal:hover {
            background-color: #218838;
        }

        .reject-button-modal { /* Renamed to avoid conflict with old handleAction */
            background-color: var(--danger);
            color: #ffffff;
        }

        .reject-button-modal:hover {
            background-color: #a71d2a;
        }

        .status-pending {
            background-color: var(--warning);
            color: var(--text-dark);
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }
        .status-approved {
            background-color: var(--success);
            color: #ffffff;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }
        .status-rejected {
            background-color: var(--danger);
            color: #ffffff;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }

        /* Custom Message Box Styles */
        .message-box {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            color: white;
            font-weight: bold;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            animation: fadeInOut 3s forwards;
        }

        .message-box.success {
            background-color: var(--success);
        }

        .message-box.error {
            background-color: var(--danger);
        }

        .message-box.info {
            background-color: #17a2b8;
        }

        .message-box-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            padding: 0 5px;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }

        /* Modal Styling (for Synopsis and Rejection Reason) */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            animation: fadeIn 0.3s ease-in-out;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px; /* Increased max-width for synopsis */
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            text-align: left;
        }

        .modal-header {
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            color: var(--primary);
            font-size: 1.5rem;
        }

        .modal-close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .modal-close-btn:hover,
        .modal-close-btn:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-body label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .modal-body textarea {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
            min-height: 80px;
            resize: vertical;
        }

        .modal-footer {
            padding-top: 15px;
            border-top: 1px solid #eee;
            text-align: right;
            margin-top: 15px;
        }

        .modal-footer .btn {
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: 0.2s ease;
            margin-left: 10px;
        }
        .modal-footer .btn-primary {
            background-color: var(--primary);
            color: #fff;
        }
        .modal-footer .btn-primary:hover {
            opacity: 0.85;
        }
        .modal-footer .btn-cancel {
            background-color: var(--gray);
            color: #fff;
        }
        .modal-footer .btn-cancel:hover {
            opacity: 0.85;
        }
        .modal-footer .btn-danger {
            background-color: var(--danger);
            color: #fff;
        }
        .modal-footer .btn-danger:hover {
            opacity: 0.85;
        }

        /* Specific styles for rejection reason box within synopsis modal */
        #rejectionReasonBox {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #e5e7eb;
        }
    </style>
</head>
<body>
    <div class="main-layout-container">
        <!-- Sidebar (Embedded HTML) -->
        <div class="sidebar">
            <h2>Admin Menu</h2>
            <nav>
                <ul>
                    <li class="mb-2">
                        <a href="dashboardAdmin.html" class="flex items-center text-lg px-4 py-2 rounded-lg hover:bg-gray-700 hover:text-blue-300 transition-colors duration-200">
                            <i class="lucide lucide-layout-dashboard mr-3"></i> Dashboard
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="manageEbook.html" class="flex items-center text-lg px-4 py-2 rounded-lg hover:bg-gray-700 hover:text-blue-300 transition-colors duration-200">
                            <i class="lucide lucide-book-open mr-3"></i> Manage Ebooks
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="manageUser.html" class="flex items-center text-lg px-4 py-2 rounded-lg hover:bg-gray-700 hover:text-blue-300 transition-colors duration-200">
                            <i class="lucide lucide-users mr-3"></i> Manage Users
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="approveBookList.html" class="flex items-center text-lg px-4 py-2 rounded-lg hover:bg-gray-700 hover:text-blue-300 transition-colors duration-200">
                            <i class="lucide lucide-check-circle mr-3"></i> Approved Books
                        </a>
                    </li>
                </ul>
            </nav>
        </div>

        <div class="main-content">
            <div class="page-header">
                <h1>Manage Ebooks</h1>
                <div class="date-info">
                    <p>Welcome, Administrator!</p>
                    <p><script>document.write(new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }));</script></p>
                </div>
            </div>

            <div class="search-bar">
                <input type="text" id="searchInput" onkeyup="searchBooks()" placeholder="Search by title, author, or year...">
            </div>

            <div class="table-container">
                <table id="ebook-table">
                    <thead>
                        <tr>
                            <th>Cover</th>
                            <th>Title</th>
                            <th>Author</th>
                            <th>Year Published</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Ebook rows will be dynamically inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Synopsis Modal -->
    <div id="synopsisModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="synopsisModalTitle">Book Synopsis</h2>
                <span class="modal-close-btn" onclick="closeModal('synopsisModal')">&times;</span>
            </div>
            <div class="modal-body">
                <p id="synopsisText"></p>
                <div id="rejectionReasonBox" style="display:none;">
                    <label for="rejectionReason">Reason for Rejection:</label>
                    <textarea id="rejectionReason" placeholder="Enter reason for rejection..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn approve-button-modal" onclick="approveBookFromModal()">Approve</button>
                <button class="btn reject-button-modal" onclick="toggleRejectionReason()">Reject</button>
                <button class="btn btn-danger" id="submitRejectionBtn" style="display:none;" onclick="submitRejection()">Submit Rejection</button>
                <button class="btn btn-cancel" onclick="closeModal('synopsisModal')">Cancel</button>
            </div>
        </div>
    </div>
</body>
</html>
